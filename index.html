<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#0b0f19" />

    <title>Flashcard Quiz</title>

    <style>
      :root {
        color-scheme: dark;
        --bg: #0b0f19;
        --card: #111a2e;
        --panel: #0d1426;
        --border: #203055;
        --border2: #3a57a5;
        --text: #e8eefc;
        --muted: #a9b7d6;
        --good: #7cffb2;
        --bad: #ff7c7c;
        --primary: #2a4ff0;

        /* iOS safe-area */
        --sat: env(safe-area-inset-top, 0px);
        --sar: env(safe-area-inset-right, 0px);
        --sab: env(safe-area-inset-bottom, 0px);
        --sal: env(safe-area-inset-left, 0px);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial,
          sans-serif;
        -webkit-text-size-adjust: 100%;
        padding: calc(12px + var(--sat)) calc(12px + var(--sar))
          calc(12px + var(--sab)) calc(12px + var(--sal));
      }

      /* App container */
      .wrap {
        max-width: 980px;
        margin: 0 auto;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px;
        overflow: hidden;
      }

      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
      }

      h1 {
        margin: 0 0 4px;
        font-size: clamp(18px, 2.3vw, 22px);
        letter-spacing: 0.2px;
      }
      .muted {
        color: var(--muted);
        font-size: 14px;
      }
      .title {
        font-size: 16px;
        font-weight: 750;
        margin: 0 0 10px;
      }
      .q {
        font-size: clamp(16px, 2.1vw, 18px);
        line-height: 1.45;
        margin: 0 0 14px;
        word-break: break-word;
      }

      .pill {
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: var(--panel);
        color: var(--muted);
        white-space: nowrap;
      }

      .controls {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      select,
      input[type="number"] {
        background: var(--panel);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px 12px;
        font-size: 16px; /* iOS: avoid zoom on focus */
        max-width: 120px;
      }
      .checkline {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--muted);
      }

      .hr {
        height: 1px;
        background: var(--border);
        margin: 14px 0;
      }

      .opts {
        display: grid;
        gap: 12px;
        padding-bottom: 10px;
      }

      label.opt {
        display: flex;
        gap: 12px;
        align-items: flex-start;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
        cursor: pointer;
        -webkit-tap-highlight-color: rgba(255, 255, 255, 0.08);
        user-select: none;
        touch-action: manipulation;
      }
      label.opt:active {
        border-color: var(--border2);
        transform: scale(0.997);
      }

      input[type="radio"],
      input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-top: 2px;
        flex: 0 0 auto;
      }
      label.opt span {
        display: block;
        font-size: 16px;
        line-height: 1.35;
      }

      .small {
        font-size: 13px;
        color: var(--muted);
      }

      /* Buttons */
      button {
        background: var(--primary);
        color: white;
        border: 0;
        border-radius: 14px;
        padding: 14px 14px;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        touch-action: manipulation;
      }
      button.secondary {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }
      button.danger {
        background: #a33232;
      }
      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }

      /* Sticky bottom action bar for mobile */
      .actionBar {
        position: sticky;
        bottom: calc(-1px);
        background: linear-gradient(
          to top,
          rgba(11, 15, 25, 0.98),
          rgba(11, 15, 25, 0.65)
        );
        backdrop-filter: blur(8px);
        border-top: 1px solid var(--border);
        margin: 14px -16px -16px;
        padding: 12px 16px calc(12px + var(--sab));
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
      }
      .btnGroup {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      /* Results */
      .review {
        display: grid;
        gap: 12px;
      }
      .revItem {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
      }
      .good {
        color: var(--good);
        font-weight: 700;
      }
      .bad {
        color: var(--bad);
        font-weight: 700;
      }

      /* Improve readability on very small screens */
      @media (max-width: 420px) {
        .card {
          padding: 14px;
        }
        label.opt {
          padding: 12px;
        }
        button {
          width: 100%;
        }
        .btnGroup {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="card">
        <div class="row">
          <div>
            <h1>Online Quiz</h1>
            <div class="muted">
              Works well on iPhone Safari • Tap-friendly options • Sticky
              controls
            </div>
          </div>
          <div class="controls">
            <span class="pill" id="statusPill">Not started</span>

            <label class="checkline"
              >Questions
              <select id="countSelect">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="40">40</option>
                <option value="9999" selected>All</option>
              </select>
            </label>

            <label class="checkline"
              >Choices (single)
              <input
                id="choicesInput"
                type="number"
                min="2"
                max="8"
                value="4"
              />
            </label>

            <label class="checkline">
              <input id="shuffleToggle" type="checkbox" checked />
              Shuffle
            </label>

            <button id="startBtn">Start</button>
            <button id="restartBtn" class="secondary" style="display: none">
              Restart
            </button>
          </div>
        </div>

        <div class="hr"></div>

        <div id="quizArea" style="display: none">
          <div class="row" style="margin-bottom: 10px">
            <div class="muted" id="progressText">Question 1 / 1</div>
            <div class="muted">Score: <span id="scoreText">0</span></div>
          </div>

          <div class="title" id="typeTitle">Type</div>
          <p class="q" id="questionText">Question…</p>

          <div class="opts" id="optionsBox"></div>

          <div class="small" id="feedback" style="margin-top: 4px"></div>

          <div class="actionBar">
            <div class="btnGroup">
              <button id="backBtn" class="secondary">Back</button>
              <button id="nextBtn">Next</button>
            </div>
            <div class="btnGroup">
              <button id="checkBtn" class="secondary">Check</button>
              <button id="finishBtn" class="danger">Finish</button>
            </div>
          </div>
        </div>

        <div id="resultsArea" style="display: none">
          <div class="row">
            <div>
              <div class="title" style="margin: 0">Results</div>
              <div class="muted" id="resultsSummary"></div>
            </div>
            <div class="btnGroup">
              <button id="reviewToggleBtn" class="secondary">
                Show review
              </button>
              <button id="downloadBtn" class="secondary">Download JSON</button>
            </div>
          </div>

          <div class="hr"></div>
          <div id="reviewArea" style="display: none" class="review"></div>
        </div>
      </div>
    </div>

    <script>
      // Flashcards dataset (Q/A)
      // - answers is always an array (even for single-answer cards)

      const flashcards = [
        {
          id: 1,
          question: "What interacts in the immune response?",
          answers: ["Leukocytes, Antibodies, Lymphocytes"],
        },
        {
          id: 2,
          question:
            "A client asks why they should take all prescribed doses of the antimicrobial drug they were prescribed. What response(s) will the nurse provide to address the client's concern?",
          answers: [
            '"Taking all the medication will help prevent the infection from recurring."',
            '"Stopping the therapy prematurely can lead to the development of microorganisms that are unaffected by the antimicrobial drug."',
            '"The reoccurring infection will likely be more severe."',
            '"The reoccurring infection will be much more difficult to treat."',
          ],
        },
        {
          id: 3,
          question:
            "To ensure that the most appropriate drug is being used to treat a pathogen, which would need to be done first?",
          answers: ["Obtaining sensitivity testing"],
        },
        {
          id: 4,
          question:
            "When caring for infants and older adults who are in need of an antimicrobial agent, the nurse is aware that when compared with doses for young and middle-aged adults, these clients may require?",
          answers: ["A lower dose"],
        },
        {
          id: 5,
          question:
            "A medical nurse on a night shift is reviewing a client's medication administration record for the following day. The nurse notes that a combination antimicrobial drug is prescribed. What is implied by the fact that the client has been prescribed a combination drug?",
          answers: [
            "The client may have an infection caused by multiple microorganisms",
          ],
        },
        {
          id: 6,
          question:
            "Administration of what type of antibiotic by the nurse would be most likely to cause a superinfection?",
          answers: ["Broad spectrum"],
        },
        {
          id: 7,
          question:
            "A client is admitted to the unit and the nurse is performing a comprehensive assessment. What findings should the nurse interpret as indicating increased risk for infection?",
          answers: [
            "The client appears to be malnourished",
            "The client is under intense psychosocial stress",
            "The client is 81 years old",
          ],
        },
        {
          id: 8,
          question:
            "What occurs when the normal flora is destroyed by the use of anti-infectives?",
          answers: ["Superinfection"],
        },
        {
          id: 9,
          question:
            "When reviewing the medication orders, a nurse notes that combination therapy with two anti-infective agents has been ordered. What is the nurse's best interpretation of this order?",
          answers: [
            "The client has an infection that may be caused by more than one organism",
          ],
        },
        {
          id: 10,
          question:
            "The nurse is providing care for an older adult who has a urinary tract infection. What aspect of this client's current health status should the nurse focus on when ensuring safe and effective antibiotic therapy?",
          answers: ["The client has a history of cirrhosis"],
        },
        {
          id: 11,
          question:
            "An immunocompromised client in a critical care setting has developed a respiratory infection that has been attributed to methicillin-resistant Staphylococcus aureus (MRSA). The nurse should anticipate that the client will require treatment with?",
          answers: ["Vancomycin"],
        },
        {
          id: 12,
          question:
            "A client asks a nurse why the health care provider has prescribed two anti-infective agents. Which response by the nurse would be most appropriate?",
          answers: [
            '"Your infection, like many infections, is caused by more than one organism."',
          ],
        },
        {
          id: 13,
          question:
            "An older adult client being seen in the clinic with a urinary tract infection has a medical history of myocardial infarction, stroke, and renal insufficiency. What action should the nurse take first when the health care provider prescribes nitrofurantoin 100 mg twice daily?",
          answers: [
            "Call the health care provider to question the prescription.",
          ],
        },
        {
          id: 14,
          question:
            "A female client comes to the clinic reporting vaginal discharge with itching. When obtaining the client's medication history, what would the nurse consider as significant?",
          answers: ["Broad spectrum anti-infective for recent infection"],
        },
        {
          id: 15,
          question:
            "The nurse is caring for a client receiving vancomycin 1,000 mg IV for a wound infection, and the nurse notes that the infusion is completed earlier than expected. The nurse assesses the client and notes that the client's blood pressure is 80/60 mm Hg and the client appears flushed, with a rash noted on the face, neck, chest, and back. What action(s) should the nurse take?",
          answers: [
            "Notify the health care provider.",
            "Prepare to infuse IV fluids.",
            "Prepare to administer diphenhydramine.",
            "Complete an incident report.",
          ],
        },
        {
          id: 16,
          question:
            "A client with an upper respiratory tract infection was prescribed roxithromycin, an antibiotic. The nurse tells the client that irregular administration of this medication could lead to what outcome?",
          answers: ["Development of drug resistance"],
        },
        {
          id: 17,
          question:
            "A client is to undergo extensive dental surgery. The dentist prescribes a course of antibiotics before beginning the procedure and continuing for 5 days after the procedure. This is an example of?",
          answers: ["Prophylaxis"],
        },
        {
          id: 18,
          question:
            "A client comes to the clinic reporting mouth sores that appear consistent with an oral yeast infection. The nurse should question the client about recent use of?",
          answers: ["Antibiotics"],
        },
        {
          id: 19,
          question:
            "A hospital nurse is aware that hospital-acquired infections pose a significant threat to many clients' health status. In order to reduce the spread of these infections, the nurse should prioritize which action?",
          answers: ["Vigilant and thorough hand hygiene"],
        },
        {
          id: 20,
          question:
            "A client prescribed an antimicrobial drug has been given instructions regarding how to maintain a balanced diet, adequate fluid intake, rest, and exercise—and the effects these lifestyle measures have on infection control. Which client statement(s) indicates an understanding of this information?",
          answers: [
            '"Being well nourished helps my body have what it needs to fight off infection more effectively."',
            '"I will certainly drink more water since I know how important it is to preventing future infections."',
            '"Maintaining a healthy lifestyle makes it possible for my body to work as well as it can."',
            '"Being healthy to begin with makes it easier for antimicrobial drug therapy to work effectively."',
            '"Being well rested helps maintain a healthy immune system."',
          ],
        },
        {
          id: 21,
          question:
            "The nurse on a pediatric unit is caring for a client with a wound infection. The client has been prescribed vancomycin 40 mg/kg per day intramuscularly in 4 divided doses. What action should the nurse take first?",
          answers: ["Question the medication route of administration"],
        },
        {
          id: 22,
          question:
            "A middle-aged client is to receive tetracycline for treatment of H. pylori infection, as well as continue with digoxin for a history of heart disease. The nurse will be prepared to monitor the client for which potential condition?",
          answers: ["Risk of digoxin toxicity"],
        },
        {
          id: 23,
          question:
            "A nurse is educating a client who has been prescribed erythromycin. What statement(s) made by the client demonstrates an understanding of appropriate administration of the medication? Select all that apply.",
          answers: [
            '"It\'s important to drink 8 ounces of fluid when taking the pills."',
            '"I can\'t eat ice cream within 2 hours of taking my erythromycin."',
            '"I need to wait at least 2 to 3 hours after eating to take my pill."',
            '"I should avoid eating grapefruit during this medication therapy."',
          ],
        },
        {
          id: 24,
          question:
            "The goals for a client taking antitubercular drugs can include what goals?",
          answers: [
            "Identification and treatment of adverse reactions.",
            "Maintenance of adequate nutritional status.",
            "Client and family demonstrate an understanding of the drug regimen.",
            "Client manages the therapeutic regimen effectively.",
            "Therapeutic response is achieved.",
          ],
        },
        {
          id: 25,
          question:
            "A nurse is monitoring the effectiveness of amoxicillin treatment in a client with otitis media. Which structure will the nurse monitor in this client?",
          answers: ["Tympanic membrane"],
        },
        {
          id: 26,
          question:
            "The nurse is aware that sulfonamide therapy is used cautiously in older adults because of decreased function of what organ system?",
          answers: ["Renal"],
        },
        {
          id: 27,
          question:
            "A client, hospitalized with active tuberculosis, is receiving antitubercular drug therapy but has not experienced the expected therapeutic effects. The nurse will collaborate with the care provider to rule out what possible cause?",
          answers: ["Drug-resistant tuberculosis"],
        },
        {
          id: 28,
          question:
            "A client has a history of a life-threatening anaphylactic reaction to penicillin G. Which medication should not be administered to this client?",
          answers: ["Cefadroxil"],
        },
        {
          id: 29,
          question:
            "A nurse is conducting an in-service about antibacterial drugs such as penicillins and cephalosporins. During the question-and-answer period, the audience asks for examples of conditions that can be treated by cephalosporins. Which examples would the nurse include in the response?",
          answers: ["Urinary tract infections"],
        },
        {
          id: 30,
          question:
            "A nurse is caring for a client who is receiving cephalosporin. Which histories will a nurse obtain as part of the preadministration assessment?",
          answers: [
            "allergy history",
            "drug history",
            "surgical treatment history",
          ],
        },
        {
          id: 31,
          question:
            "After teaching a group of nursing students about the action of penicillins, the instructor determines that the teaching was effective when the students identify natural penicillins as exerting which type of effect on microorganisms?",
          answers: ["Bactericidal"],
        },
        {
          id: 32,
          question:
            "A client who routinely takes antacids has been prescribed tetracycline. The nurse explains to the client that there is an increased risk of which effect related to this combination?",
          answers: ["Decreased absorption of tetracycline"],
        },
        {
          id: 33,
          question:
            "The nurse is teaching a client about possible adverse reactions that can occur with tetracyclines. The nurse determines that the teaching was successful when the client identifies which reaction?",
          answers: ["Photosensitivity", "Diarrhea", "Stomatitis"],
        },
        {
          id: 34,
          question:
            "In preparation for discharge, the nurse is teaching a client about the prescription for telithromycin. The nurse should instruct the client to contact a health care provider if the client experiences?",
          answers: ["Yellowing of the eyes or skin."],
        },
        {
          id: 35,
          question:
            "A client is admitted to the critical care unit with sepsis related to a contaminated central line. The health care provider orders intravenous beta-lactam antimicrobials. The client's current laboratory report reflects renal impairment. What would the nurse expect the health care provider to do?",
          answers: ["Decrease the drug dose"],
        },
        {
          id: 36,
          question:
            "The nurse knows that pseudomembranous colitis is a superinfection of fluoroquinolones, especially when they are administered in high doses, because these medications have what effect in the body?",
          answers: ["They disrupt the normal flora of the body"],
        },
        {
          id: 37,
          question:
            "Drugs that destroy bacteria are known as which type of drug?",
          answers: ["Bactericidal"],
        },
        {
          id: 38,
          question:
            "The client has been prescribed a fluoroquinolone. The nurse knows that nursing interventions for clients taking fluoroquinolones include which?",
          answers: ["Increase fluid intake"],
        },
        {
          id: 39,
          question:
            "A client has been prescribed oral tetracycline for the treatment of acne. Which instruction must the nurse include in the client teaching plan?",
          answers: ["Take the drug on an empty stomach"],
        },
        {
          id: 40,
          question:
            "The nurse is caring for a 6-year-old child who has pyelonephritis. The use of what group of antibiotics would be contraindicated due to the client's age?",
          answers: ["Tetracyclines"],
        },
        {
          id: 41,
          question:
            "A client is HIV positive and is involved in ART to decrease symptoms and increase lifespan and quality. The regimen currently involves a combination of antiretrovirals. The rationale to support this treatment regimen is?",
          answers: [
            "To increase drug efficacy.",
            "To decrease viral mutations.",
          ],
        },
        {
          id: 42,
          question:
            "A client on a medical unit who was diagnosed with COVID-19 pneumonia is being prepared for their initial dose of remdesivir 200 mg. What action(s) should the nurse take before administering the medication?",
          answers: [
            "Review the client's laboratory data.",
            "Insert an intravenous access line.",
            "Ask the client when their COVID-19 symptoms began.",
          ],
        },
        {
          id: 43,
          question:
            "In which of the following clients is the use of cidofovir contraindicated?",
          answers: ["Clients with renal impairment"],
        },
        {
          id: 44,
          question:
            "A 21-year-old diagnosed with HIV/AIDS 4 years ago now presents with cytomegalovirus (CMV). The nurse explains to the client that this infection is caused by a common organism that normally does not cause infection in someone who is not what?",
          answers: ["Immunocompromised"],
        },
        {
          id: 45,
          question:
            "What statement made by the client indicates to the nurse that the client does not understand the transmission of HIV?",
          answers: [
            '"As long as I am taking the HAART therapy, I cannot transmit the virus to anyone else."',
          ],
        },
        {
          id: 46,
          question:
            "A client who is positive for human immunodeficiency virus (HIV) is prescribed the protease inhibitor atazanavir. Which laboratory test will the nurse anticipate being prescribed before the client receives a dose of the medication?",
          answers: ["Liver function tests"],
        },
        {
          id: 47,
          question: "Which hepatic viruses can be prevented by vaccination?",
          answers: ["hepatitis A", "hepatitis B"],
        },
        {
          id: 48,
          question:
            "The nurse is providing health education to a client who has recently been diagnosed with HIV and will soon begin antiretroviral therapy. What teaching point should the nurse prioritize?",
          answers: [
            "The need to adhere rigidly to the prescribed drug schedule",
          ],
        },
        {
          id: 49,
          question:
            "A 45-year-old client is prescribed acyclovir for the treatment of genital herpes. Which is an expected outcome for this client?",
          answers: ["The client will experience fewer recurrences"],
        },
        {
          id: 50,
          question:
            "To prevent viral infections, what precaution should the general public take?",
          answers: ["Become vaccinated against prevalent virus infections."],
        },
        {
          id: 51,
          question:
            "A client is prescribed mebendazole. The nurse reviews the client's medication history for possible drug interactions. Which would the nurse identify as lowering the levels of mebendazole?",
          answers: ["carbamazepine", "phenytoin"],
        },
        {
          id: 52,
          question:
            "It is felt that the incidence of fungal infections has increased due to what?",
          answers: ["ARC", "AIDS", "Increasingly large older adult population"],
        },
        {
          id: 53,
          question:
            "A client tells the nurse that they have taken several doses of over-the-counter fluconazole to treat a \"yeast infection.\" When assessing the client's risk for drug toxicity, what aspect of the client's health status should the nurse prioritize?",
          answers: [
            "The client has decreased renal function following recent pyelonephritis",
          ],
        },
        {
          id: 54,
          question:
            "A pharmacology student is learning about amphotericin B. This drug can be administered via which route?",
          answers: ["IV"],
        },
        {
          id: 55,
          question:
            "A school-aged client's esophageal candidiasis has failed to respond to first-line antifungal treatments. As a result, the client has been prescribed micofungin 2.5 mg/kg IV daily. The client weighs 44 lb. Before administering the medication, the nurse should confirm what dose? Record the answer as a whole number.",
          answers: ["50"],
        },
        {
          id: 56,
          question:
            "A client with a cutaneous fungal infection has been prescribed naftifine. When reviewing the prescriber's instructions, what should the nurse explain to the client?",
          answers: ['"Make sure you don\'t use this for more than one month."'],
        },
        {
          id: 57,
          question:
            "An adult client, recently diagnosed with a tinea infection, has begun treatment with griseofulvin. During a scheduled clinic visit, the client states to the nurse, \"I'm pretty good at reading my body's signals, so I make sure to take a bit extra when I think my infection is getting worse.\" This client's statement is suggestive of what nursing diagnosis?",
          answers: [
            "Deficient knowledge related to correct use of griseofulvin",
          ],
        },
        {
          id: 58,
          question:
            "A nurse is instructing a 19-year-old female client on the use of fluconazole for candida vaginitis. A teaching priority will be to?",
          answers: [
            "Use an alternative form of birth control, if taking an oral contraceptive",
          ],
        },
        {
          id: 59,
          question:
            "Amphotericin B is ordered for a client with thrush. How does the drug combat the infection?",
          answers: ["It acts on the fungal cell membrane"],
        },
        {
          id: 60,
          question:
            "Students learning about antifungal medication are taught that what medications will increase the effects of fluconazole?",
          answers: ["Warfarin"],
        },
        {
          id: 61,
          question:
            "A client is receiving mefloquine as part of a treatment for malaria asks the nurse about becoming pregnant. Which response by the nurse would be most appropriate?",
          answers: [
            '"You need to avoid pregnancy during the therapy and for 2 months after completion."',
          ],
        },
        {
          id: 62,
          question:
            "Which agent would the nurse expect to administer to a client with leishmaniasis?",
          answers: ["Pentamidine"],
        },
        {
          id: 63,
          question:
            "A client who is working in an area where malaria is endemic has been taking Malarone one tablet daily for prophylaxis for several months. The client has called the clinic to report loss of visual acuity to the nurse. What is the nurse's best action?",
          answers: [
            "Have the client assessed by the health care provider immediately",
          ],
        },
        {
          id: 64,
          question:
            "A nurse is reviewing the health record of a client for whom antimalarial therapy is being proposed. The nurse should identify what aspect of the client's history as contraindicating the use of antimalarials?",
          answers: ["Liver disease"],
        },
        {
          id: 65,
          question:
            "A nurse is preparing to administer primaquine therapy to a client. The nurse should anticipate administering the drug by which route?",
          answers: ["Oral"],
        },
        {
          id: 66,
          question:
            "Which recommendations should be made to a client being treated for trichomoniasis to prevent re-infection?",
          answers: ["Sexual partners should be treated"],
        },
        {
          id: 67,
          question:
            'A sexually active teen tells the nurse, "My sexual partner is being treated for trichomoniasis." What is the nurse\'s best response when the teen asks about receiving treatment as well?',
          answers: ['"You need to be treated simultaneously."'],
        },
        {
          id: 68,
          question:
            "A client has been diagnosed with malaria and will begin treatment promptly. What is the best way to attack the Plasmodium protozoa's life cycle?",
          answers: ["Administer combination therapy as prescribed"],
        },
        {
          id: 69,
          question:
            "With the emergence of chloroquine-resistant strains of Plasmodium, the Centers for Disease Control and Prevention recommends the use of quinine with an antibiotic as a combination therapy for the treatment of uncomplicated or severe malaria. What are the correct antibiotics to use?",
          answers: ["Doxycycline", "Tetracycline", "Clindamycin"],
        },
        {
          id: 70,
          question:
            "A 28-year-old female client is planning to be part of a mission team going to Central Africa. The client will take mefloquine once a week, beginning 1 week before traveling to Africa until 4 weeks after leaving Africa. What will the nurse be sure to question the client about?",
          answers: ["The client's last menstrual period"],
        },
        {
          id: 71,
          question:
            "Two children in the same family have been diagnosed with pinworms and are being treated with mebendazole. What health promotion teaching should the nurse provide to the children's parents?",
          answers: [
            "Have all family members perform consistent, thorough hand hygiene.",
            "Wash the children's sheets with hot water and bleach.",
            "Have the children bathe or shower daily.",
          ],
        },
        {
          id: 72,
          question:
            "A client who returned from missionary work in a rainforest is diagnosed with whipworms. Which finding would the nurse expect to assess in this client?",
          answers: ["Bloody diarrhea with worms in the stool"],
        },
        {
          id: 73,
          question: "What are considered helminths?",
          answers: ["Roundworms", "Pinworms", "Hookworms", "Tapeworms"],
        },
        {
          id: 74,
          question:
            "The nurse is providing emergency health care at a refugee camp and there are several clients who are being treated for helminthic infections. What client should the nurse prioritize for referral to one of the camp care providers?",
          answers: [
            "A client who is taking albendazole and whose urine output has decreased sharply over the past 24 hours",
          ],
        },
        {
          id: 75,
          question:
            "A 9-year-old child was diagnosed with hookworm infection and will be sent home with a prescription for mebendazole. When providing education, the nurse should teach the parent which measures to avoid reinfection following treatment?",
          answers: [
            "The importance of vigilant hygiene for the client and the other members of the family",
          ],
        },
        {
          id: 76,
          question:
            "Which activity would be appropriate for a nurse to include when teaching a community group about measures to prevent trichinosis?",
          answers: ["Ensuring that any pork products are thoroughly cooked"],
        },
        {
          id: 77,
          question: "Which worms are considered to be nematodes?",
          answers: ["pinworms", "whipworms", "threadworms", "hookworms"],
        },
        {
          id: 78,
          question:
            "The nurse has provided health education to a client who has been prescribed praziquantel PO for the treatment of a helminth infection. What statement by the client should the nurse correct or clarify?",
          answers: [
            "\"I'll keep taking these diligently until I'm rid of this infection.\"",
          ],
        },
        {
          id: 79,
          question:
            "Which are the most frequent cause of helminth infections in the United States?",
          answers: ["Pinworms"],
        },
        {
          id: 80,
          question: "What helminths should the nurse classify as nematodes?",
          answers: ["Pinworm", "Whipworm", "Threadworm"],
        },
        {
          id: 81,
          question:
            "A client is prescribed doxorubicin drug therapy for carcinoma of the breast. On the second day of drug therapy, they call in to report reddish urine. What should the nurse do?",
          answers: [
            "Reassure the client that it is a harmless and expected response to the drug.",
          ],
        },
        {
          id: 82,
          question:
            "A health care provider has prescribed an alkylating agent for a client. The nurse anticipates administering which drug(s) to the client?",
          answers: ["Chlorambucil", "Cyclophosphamide", "Ifosfamide"],
        },
        {
          id: 83,
          question:
            "A 42-year-old female with breast cancer has had a radical mastectomy. They will have radiation therapy and then begin chemotherapy. Drug therapy will consist of a combination of doxorubicin, cyclophosphamide, and paclitaxel. What will the nurse include in the teaching plan concerning the drug therapy?",
          answers: ["Take special care when shaving or brushing their teeth"],
        },
        {
          id: 84,
          question:
            "A client's chemotherapeutic regimen includes procarbazine. What is the client's most likely diagnosis?",
          answers: ["Hodgkin lymphoma"],
        },
        {
          id: 85,
          question:
            "A client newly diagnosed with CML has been prescribed treatment with imatinib. The client asks the nurse how imatinib works. What would be the nurse's best response?",
          answers: [
            '"Imatinib inhibits the enzyme created by the Philadelphia chromosome abnormality in CML."',
          ],
        },
        {
          id: 86,
          question:
            "A nurse is preparing to administer etoposide to a client. Which assessment finding that could influence dosing should the nurse prioritize in the preadministration assessment?",
          answers: ["Complete blood count"],
        },
        {
          id: 87,
          question:
            "The community health nurse is planning care for a client who will be prescribed an oral chemotherapy drug for the next several months while recovering at home. What health education topic should the nurse emphasize?",
          answers: ["Techniques for safely handling the drug"],
        },
        {
          id: 88,
          question:
            "The nursing instructor is teaching a session about chemotherapeutic antibiotics. The instructor determines the session is successful when the students correctly choose which drug(s) in this category?",
          answers: ["Bleomycin", "Dactinomycin", "Daunorubicin"],
        },
        {
          id: 89,
          question:
            "The nurse is preparing a client who will begin chemotherapy in a few days. The nurse knows that which are the most common adverse effects encountered by most clients who receive chemotherapy?",
          answers: ["Alopecia", "Thrombocytopenia", "Anemia"],
        },
        {
          id: 90,
          question:
            "A nurse is preparing to administer a traditional chemotherapeutic agent that is classified as an antimetabolite. Which drug(s) might the nurse be preparing to give?",
          answers: ["Mercaptopurine", "Capecitabine", "Fluorouracil"],
        },
        {
          id: 91,
          question:
            "T/F: Common adverse reactions to anti-infective agents include toxic effects on the kidneys, gastrointestinal tract, and nervous system.",
          answers: ["True"],
        },
        {
          id: 92,
          question:
            "How can providers help prevent resistance of microorganisms to anti-infective drugs?",
          answers: [
            "Limit use of antimicrobial agents to treatment of specific pathogens",
          ],
        },
        {
          id: 93,
          question:
            "T/F: Sensitivity testing is used to determine which drugs are capable of controlling an infective organism.",
          answers: ["True"],
        },
        {
          id: 94,
          question:
            "T/F: Anti-infective drugs act selectively on foreign organisms that have infected the host body.",
          answers: ["True"],
        },
        {
          id: 95,
          question:
            "What is the name for antibiotic therapy that uses two or more types of drugs to treat an infection?",
          answers: ["Combination"],
        },
        {
          id: 96,
          question: "In what way do bactericidal drugs act?",
          answers: ["Cause the death of the cells they affect"],
        },
        {
          id: 97,
          question:
            "T/F: Antibiotics are generally effective against both bacteria and viral infective organisms.",
          answers: ["False"],
        },
        {
          id: 98,
          question:
            "T/F: Some anti-infectives are used as a means of prophylaxis when patients expect to be in situations that will expose them to a known pathogen.",
          answers: ["True"],
        },
        {
          id: 99,
          question:
            "How is a culture obtained from infected tissue or body areas used?",
          answers: ["To help identify infective agents"],
        },
        {
          id: 100,
          question:
            "Which type of drug has an anti-infective action that prevents the pathogen or invading organisms from reproducing?",
          answers: ["Bacteriostatic"],
        },
        {
          id: 101,
          question:
            "The sulfonamides treat infections by inhibiting synthesis of which?",
          answers: ["Folic acid"],
        },
        {
          id: 102,
          question:
            "T/F: Cephalosporins can be classified as either bactericidal or bacteriostatic depending on which specific drug and dose are used.",
          answers: ["True"],
        },
        {
          id: 103,
          question:
            "AA bacterium that depends on oxygen in order to survive is called?",
          answers: ["Aerobic"],
        },
        {
          id: 104,
          question: "Which does not use oxygen to survive?",
          answers: ["Gangrene"],
        },
        {
          id: 105,
          question: "Which is true of gram-negative bacteria?",
          answers: ["The cell wall is decolorized by alcohol"],
        },
        {
          id: 106,
          question:
            "T/F: Fluoroquinolones are used to treat susceptible strains of gram-positive bacteria.",
          answers: ["False"],
        },
        {
          id: 107,
          question:
            "T/F: When patients are allergic to penicillin, erythromycin has proven to be an effective alternative",
          answers: ["True"],
        },
        {
          id: 108,
          question:
            "When antibiotics are given in combination so that their combined effects are greater than if they were given individually, they are considered to be?",
          answers: ["Synergistic"],
        },
        {
          id: 109,
          question:
            "T/F: Aminoglycosides are an example of antibiotics that are classified as bacteriostatic.",
          answers: ["False"],
        },
        {
          id: 110,
          question:
            "T/F: A Gram's stain is used to identify gram-positive bacteria by retaining a stain within its cell wall.",
          answers: ["True"],
        },
        {
          id: 111,
          question:
            "T/F: Rimantadine (Flumadine) is a synthetic antiviral agent used to prevent and treat influenza A",
          answers: ["True"],
        },
        {
          id: 112,
          question:
            "Oseltamivir (Tamiflu) has been found to be effective in treating uncomplicated influenza infections if taken within how many days of the onset of symptoms?",
          answers: ["Two"],
        },
        {
          id: 113,
          question:
            "T/F: Viruses survive by injecting their own DNA or RNA into a healthy cell and taking over its function",
          answers: ["True"],
        },
        {
          id: 114,
          question:
            "T/F: Protease inhibitors are effective by blocking the protease activity within HIV",
          answers: ["True"],
        },
        {
          id: 115,
          question:
            "Which nucleoside has been proven to be safe when used during pregnancy?",
          answers: ["Zidovudine"],
        },
        {
          id: 116,
          question: "Which is treated with acyclovir (Zovirax)?",
          answers: ["Herpes"],
        },
        {
          id: 117,
          question:
            "Which class of drugs functions by competing with the naturally occurring structural units within the cell that the virus would use to build the DNA chain?",
          answers: ["Nucleoside reverse transcriptase inhibitors"],
        },
        {
          id: 118,
          question:
            "T/F: Drugs used for the treatment of herpes and CMV are safe to use in lactating patients.",
          answers: ["False"],
        },
        {
          id: 119,
          question:
            "Fusion inhibitors prevent the HIV-1 virus from entering the cell by stopping fusion of the virus with the?",
          answers: ["Cellular membrane"],
        },
        {
          id: 120,
          question:
            "T/F: Cidofovir (generic) is used to treat CMV retinitis in otherwise healthy patients.",
          answers: ["False"],
        },
        {
          id: 121,
          question: "Dermatophytes are fungi that cause infections of which?",
          answers: ["Skin and mucous membranes"],
        },
        {
          id: 122,
          question:
            "Which fungus is also called ringworm and causes infections such as athlete's foot and jock itch?",
          answers: ["Tinea"],
        },
        {
          id: 123,
          question:
            "The oral medication nystatin (generic) is indicated for treatment of which?",
          answers: ["Intestinal candidiasis"],
        },
        {
          id: 124,
          question: "T/F: Mycosis is an infection that is caused by a fungus.",
          answers: ["True"],
        },
        {
          id: 125,
          question:
            "T/F: Systemic antifungal agents are easily tolerated by patients with a low risk of toxicity.",
          answers: ["False"],
        },
        {
          id: 126,
          question:
            "T/F: Antifungal agents can be used to treat bacterial superinfections that have been unresponsive to antibiotics.",
          answers: ["False"],
        },
        {
          id: 127,
          question:
            "A patient expresses to the nurse that they feel self-conscious about the scaling and flakes associated with dandruff. What does the nurse expect to be prescribed?",
          answers: ["Ketoconazole (generic)"],
        },
        {
          id: 128,
          question:
            "T/F: Caspofungin (Cancidas) has been approved for the treatment of invasive aspergillosis that is unresponsive to other treatment.",
          answers: ["True"],
        },
        {
          id: 129,
          question:
            "T/F: Fluconazole (Diflucan) can be used as a prophylactic agent for reducing the incidence of candidiasis in bone marrow transplant recipients.",
          answers: ["True"],
        },
        {
          id: 130,
          question:
            "The nurse is educating a patient about the common side effects of topical antifungals. What will they include in the teaching?",
          answers: ["Swelling"],
        },
        {
          id: 131,
          question:
            "The nurse is educating the patient about prophylactic use of an antimalarial drug during travel. Which would the nurse caution the patient to report immediately to a provider?",
          answers: ["Blurring of vision"],
        },
        {
          id: 132,
          question:
            "What was the first drug found to be effective in treating malaria but is now reserved for the treatment of chloroquine-resistant infections in combination with other agents?",
          answers: ["Quinine (Qualaquin)"],
        },
        {
          id: 133,
          question:
            "T/F: Malaria is the most common protozoal parasite that causes acute disease in travelers",
          answers: ["True"],
        },
        {
          id: 134,
          question:
            "Which is one of the ways in which toxoplasmosis is transmitted?",
          answers: ["Eating contaminated undercooked meat"],
        },
        {
          id: 135,
          question:
            "Which is well absorbed orally and is used to treat amebiasis, trichomoniasis, and giardiasis?",
          answers: ["Metronidazole (Flagyl)"],
        },
        {
          id: 136,
          question:
            "T/F: The parasites that cause human malaria enter the body through the oral/fecal route.",
          answers: ["False"],
        },
        {
          id: 137,
          question:
            "T/F: Giardiasis is the most commonly diagnosed intestinal parasite in the United States.",
          answers: ["True"],
        },
        {
          id: 138,
          question:
            "T/F: Antimalarial drugs are frequently given in combination form in order to affect the protozoa at various stages of its life cycle.",
          answers: ["True"],
        },
        {
          id: 139,
          question:
            "T/F: Lactating people planning to travel to a high-risk malaria area may safely take antimalarials because they do not enter human milk.",
          answers: ["False"],
        },
        {
          id: 140,
          question:
            "Which is a disease caused by a protozoan that is passed from sand flies to humans?",
          answers: ["Leishmaniasis"],
        },
        {
          id: 141,
          question:
            'T/F: A classic symptom of schistosomiasis infection includes a pruritic rash known as "swimmer\'s itch."',
          answers: ["True"],
        },
        {
          id: 142,
          question:
            "The nurse is caring for a patient with a hookworm infection. What symptom can the nurse expect to observe?",
          answers: ["Lethargy"],
        },
        {
          id: 143,
          question:
            "Platyhelminths, or flatworms, are a class of helminths that include which?",
          answers: ["Tapeworm"],
        },
        {
          id: 144,
          question:
            "Pinworms can be effectively treated with which oral drug given as a single dose?",
          answers: ["Pyrantel"],
        },
        {
          id: 145,
          question:
            "T/F: Ascaris infections are the most prevalent helminthic infection worldwide and generally occur as a result of poor sanitation.",
          answers: ["True"],
        },
        {
          id: 146,
          question:
            "T/F: The most common helminth infection among school-aged children is pinworms.",
          answers: ["True"],
        },
        {
          id: 147,
          question:
            "Onchocerciasis, more commonly known as river blindness and a major problem in tropical areas, can be treated easily with which drug?",
          answers: ["Ivermectin"],
        },
        {
          id: 148,
          question:
            "T/F: Anthelmintic agents are interchangeable and can be used against multiple helminthic infections.",
          answers: ["False"],
        },
        {
          id: 149,
          question:
            "T/F: Trichinosis is a disease that results from eating undercooked beef containing the encysted larvae of roundworms (Trichinella spiralis).",
          answers: ["False"],
        },
        {
          id: 150,
          question:
            "Whipworms and threadworms are examples of which class of helminths?",
          answers: ["Nematode"],
        },
        {
          id: 151,
          question:
            'Which is an active form of folic acid used to "rescue" normal cells from the adverse effects of methotrexate therapy in the treatment of osteosarcoma?',
          answers: ["Leucovorin (generic)"],
        },
        {
          id: 152,
          question:
            "T/F: Antineoplastic drugs are designed to fight cancers by altering or killing human cells.",
          answers: ["True"],
        },
        {
          id: 153,
          question:
            "Which are a drug classification that is designed to interfere with the ability of a cell to divide, blocking or altering DNA synthesis and therefore causing cell death?",
          answers: ["Mitotic inhibitors"],
        },
        {
          id: 154,
          question:
            "The nurse is educating a patient receiving an alkylating agent. Which will the nurse include in the teaching?",
          answers: ['"Cover your head when the weather gets colder."'],
        },
        {
          id: 155,
          question:
            "In educating a patient about bone marrow suppression associated with antineoplastic chemotherapy, the nurse should teach the patient to use a soft bristled toothbrush because of the effects of decreased?",
          answers: ["Platelets"],
        },
        {
          id: 156,
          question:
            "T/F: Antimetabolites are S phase specific and can be used for treating some leukemias.",
          answers: ["True"],
        },
        {
          id: 157,
          question:
            "T/F: Alkylating agents affect cells during the active phase.",
          answers: ["False"],
        },
        {
          id: 158,
          question:
            "Which drug is used to manage uric acid levels in patients with leukemia, lymphoma, and solid tumor malignancies?",
          answers: ["Rasburicase (Elitek)"],
        },
        {
          id: 159,
          question:
            "T/F: Mesna (Mesnex) is a drug given to limit certain effects of cisplatin and ifosfamide.",
          answers: ["True"],
        },
        {
          id: 160,
          question:
            "T/F: Cancers begin when a group of abnormal cells multiply and grow.",
          answers: ["False"],
        },
      ];

      // optional: export if you’re using modules
      // export default flashcards;

      /* =========================================================
   2) CONFUSABLES BANK (optional but improves wrong answers)
   ========================================================= */
      const CONFUSABLES = {
        "Leukocytes, Antibodies, Lymphocytes": [
          "Erythrocytes, Platelets, Plasma proteins",
          "Monocytes, Neutrophils, Basophils",
          "Complement, Cytokines, Interferons",
        ],
        Prophylaxis: ["Therapeutic index", "Synergism", "Superinfection"],
        "Development of drug resistance": [
          "Reduced renal clearance",
          "Cross-reactivity",
          "Idiosyncratic reaction",
        ],
        Superinfection: ["Anaphylaxis", "Cross-sensitivity", "Hepatotoxicity"],
        "Broad spectrum": ["Narrow spectrum", "Bacteriostatic", "Antiviral"],
        "Liver function tests": [
          "Complete blood count",
          "Serum creatinine",
          "Coagulation studies",
        ],
        "Complete blood count": [
          "Liver function tests",
          "Electrolytes panel",
          "Arterial blood gases",
        ],
        Renal: ["Hepatic", "Pulmonary", "Hematologic"],
        Vancomycin: ["Amoxicillin", "Azithromycin", "Ceftriaxone"],
        Cefadroxil: ["Azithromycin", "Clindamycin", "Doxycycline"],
        Tetracyclines: ["Cephalosporins", "Macrolides", "Sulfonamides"],
        Zidovudine: ["Acyclovir", "Oseltamivir", "Atazanavir"],
        Atazanavir: ["Acyclovir", "Zidovudine", "Fluconazole"],
        Acyclovir: ["Oseltamivir", "Rimantadine", "Cidofovir"],
        Cidofovir: ["Acyclovir", "Oseltamivir", "Fluconazole"],
        Fluconazole: ["Amphotericin B", "Ketoconazole", "Nystatin"],
        "Amphotericin B": ["Fluconazole", "Ketoconazole", "Caspofungin"],
        "Metronidazole (Flagyl)": ["Albendazole", "Praziquantel", "Ivermectin"],
        "Quinine (Qualaquin)": ["Chloroquine", "Primaquine", "Mefloquine"],
        Pinworms: ["Roundworms", "Tapeworms", "Hookworms"],
        Nematode: ["Cestode", "Trematode", "Protozoa"],
        "Rasburicase (Elitek)": [
          "Allopurinol",
          "Mesna (Mesnex)",
          "Leucovorin (generic)",
        ],
        Platelets: ["Neutrophils", "Hemoglobin", "Hematocrit"],
      };

      const norm = (s) => (s ?? "").toString().trim();

      function inferType(card) {
        const q = norm(card.question);
        const looksTF = q.startsWith("T/F:") || q.includes("T/F:");
        if (looksTF) return "true_false";
        const ansCount = (card.answers || []).length;
        if (ansCount > 1) return "select_multiple";
        return "single_answer";
      }

      function buildAnswerPool(cards) {
        const pool = new Set(["True", "False"]);
        for (const c of cards)
          for (const a of c.answers || []) pool.add(norm(a));
        return [...pool].filter(Boolean);
      }

      function shuffle(arr) {
        const a = [...arr];
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function pickDistractors(correctValues, pool, count) {
        const correctSet = new Set(correctValues.map(norm));
        const out = [];

        for (const c of correctValues) {
          const conf = CONFUSABLES[norm(c)] || [];
          for (const d of conf) {
            const dd = norm(d);
            if (!dd || correctSet.has(dd) || out.includes(dd)) continue;
            out.push(dd);
            if (out.length >= count) return out;
          }
        }

        const candidates = shuffle(pool);
        for (const cand of candidates) {
          const cc = norm(cand);
          if (!cc || correctSet.has(cc) || out.includes(cc)) continue;
          out.push(cc);
          if (out.length >= count) break;
        }

        return out;
      }

      function toQuizCards(
        cards,
        { optionsCount = 4, shuffleQuestions = true } = {}
      ) {
        const pool = buildAnswerPool(cards);

        const normalized = cards.map((card) => {
          const type = inferType(card);

          if (type === "true_false") {
            const correct = norm(card.answers?.[0] ?? "");
            return {
              id: card.id,
              type,
              question: card.question,
              correct,
              options: ["True", "False"],
            };
          }

          if (type === "single_answer") {
            const correct = norm(card.answers?.[0] ?? "");
            const distractors = pickDistractors(
              [correct],
              pool,
              Math.max(0, optionsCount - 1)
            );
            const options = shuffle([correct, ...distractors]).slice(
              0,
              optionsCount
            );
            return {
              id: card.id,
              type,
              question: card.question,
              correct,
              options,
            };
          }

          const correctArr = (card.answers || []).map(norm).filter(Boolean);
          const targetOptions = Math.max(
            optionsCount,
            Math.min(8, correctArr.length + 4)
          );
          const distractors = pickDistractors(
            correctArr,
            pool,
            Math.max(0, targetOptions - correctArr.length)
          );
          const options = shuffle([...correctArr, ...distractors]).slice(
            0,
            targetOptions
          );
          return {
            id: card.id,
            type,
            question: card.question,
            correct: correctArr,
            options,
          };
        });

        return shuffleQuestions ? shuffle(normalized) : normalized;
      }

      /* =========================
   UI Logic
   ========================= */
      const els = {
        statusPill: document.getElementById("statusPill"),
        countSelect: document.getElementById("countSelect"),
        choicesInput: document.getElementById("choicesInput"),
        shuffleToggle: document.getElementById("shuffleToggle"),
        startBtn: document.getElementById("startBtn"),
        restartBtn: document.getElementById("restartBtn"),

        quizArea: document.getElementById("quizArea"),
        resultsArea: document.getElementById("resultsArea"),
        reviewArea: document.getElementById("reviewArea"),

        progressText: document.getElementById("progressText"),
        scoreText: document.getElementById("scoreText"),
        typeTitle: document.getElementById("typeTitle"),
        questionText: document.getElementById("questionText"),
        optionsBox: document.getElementById("optionsBox"),
        feedback: document.getElementById("feedback"),

        backBtn: document.getElementById("backBtn"),
        nextBtn: document.getElementById("nextBtn"),
        checkBtn: document.getElementById("checkBtn"),
        finishBtn: document.getElementById("finishBtn"),

        resultsSummary: document.getElementById("resultsSummary"),
        reviewToggleBtn: document.getElementById("reviewToggleBtn"),
        downloadBtn: document.getElementById("downloadBtn"),
      };

      let quizCards = [];
      let idx = 0;
      let userAnswers = new Map(); // id -> string | string[]
      let checked = new Set();

      function setStatus(text) {
        els.statusPill.textContent = text;
      }

      function computeScore() {
        let correct = 0;
        for (const c of quizCards) {
          if (!userAnswers.has(c.id)) continue;
          if (isCorrect(c)) correct++;
        }
        return { correct };
      }

      function getUserAnswer(card) {
        const a = userAnswers.get(card.id);
        if (card.type === "select_multiple") return Array.isArray(a) ? a : [];
        return typeof a === "string" ? a : "";
      }

      function isCorrect(card) {
        const ua = getUserAnswer(card);
        if (card.type === "select_multiple") {
          const correct = new Set(card.correct.map(norm));
          const chosen = new Set(ua.map(norm));
          if (correct.size !== chosen.size) return false;
          for (const c of correct) if (!chosen.has(c)) return false;
          return true;
        }
        return norm(ua) === norm(card.correct);
      }

      function showFeedback(card) {
        const ok = isCorrect(card);
        const ua = getUserAnswer(card);

        if (card.type === "select_multiple") {
          els.feedback.innerHTML = `<div class="${ok ? "good" : "bad"}">${
            ok ? "Correct" : "Incorrect"
          }</div>
       <div class="small">Your answer: ${
         ua.length ? ua.join(", ") : "(none)"
       }</div>
       <div class="small">Correct: ${card.correct.join(", ")}</div>`;
        } else {
          els.feedback.innerHTML = `<div class="${ok ? "good" : "bad"}">${
            ok ? "Correct" : "Incorrect"
          }</div>
       <div class="small">Your answer: ${ua || "(none)"}</div>
       <div class="small">Correct: ${card.correct}</div>`;
        }
      }

      function render() {
        const card = quizCards[idx];
        if (!card) return;

        els.progressText.textContent = `Question ${idx + 1} / ${
          quizCards.length
        }`;
        els.scoreText.textContent = `${computeScore().correct} / ${
          quizCards.length
        }`;

        els.typeTitle.textContent =
          {
            true_false: "True / False",
            single_answer: "Single Answer",
            select_multiple: "Select Multiple",
          }[card.type] || card.type;

        els.questionText.textContent = card.question;
        els.optionsBox.innerHTML = "";
        els.feedback.textContent = "";

        const saved = userAnswers.get(card.id);
        const inputType =
          card.type === "select_multiple" ? "checkbox" : "radio";
        const name = `q_${card.id}`;

        card.options.forEach((opt, optIndex) => {
          const id = `${name}_${optIndex}`;
          const label = document.createElement("label");
          label.className = "opt";
          label.setAttribute("for", id);

          const input = document.createElement("input");
          input.type = inputType;
          input.id = id;
          input.name = name;
          input.value = opt;

          if (card.type === "select_multiple") {
            const arr = Array.isArray(saved) ? saved : [];
            input.checked = arr.includes(opt);
          } else {
            input.checked = saved === opt;
          }

          input.addEventListener("change", () => {
            if (card.type === "select_multiple") {
              const checkedOpts = [
                ...document.querySelectorAll(`input[name="${name}"]:checked`),
              ].map((i) => i.value);
              userAnswers.set(card.id, checkedOpts);
            } else {
              const chosen =
                document.querySelector(`input[name="${name}"]:checked`)
                  ?.value ?? "";
              userAnswers.set(card.id, chosen);
            }
            checked.delete(card.id);
            els.feedback.textContent = "";
            els.scoreText.textContent = `${computeScore().correct} / ${
              quizCards.length
            }`;
          });

          const span = document.createElement("span");
          span.textContent = opt;

          label.appendChild(input);
          label.appendChild(span);
          els.optionsBox.appendChild(label);
        });

        els.backBtn.disabled = idx === 0;
        els.nextBtn.disabled = idx === quizCards.length - 1;

        if (checked.has(card.id)) showFeedback(card);

        // Mobile-friendly: bring question to top when navigating
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function startQuiz() {
        if (!Array.isArray(flashcards) || flashcards.length === 0) {
          alert(
            "Your flashcards array is empty. Paste your full flashcards map into the file where indicated."
          );
          return;
        }

        const countRaw = parseInt(els.countSelect.value, 10);
        const optionsCount = Math.max(
          2,
          Math.min(8, parseInt(els.choicesInput.value, 10) || 4)
        );
        const shuffleQuestions = !!els.shuffleToggle.checked;

        let cards = toQuizCards(flashcards, { optionsCount, shuffleQuestions });
        if (countRaw !== 9999)
          cards = cards.slice(0, Math.min(countRaw, cards.length));

        quizCards = cards;
        idx = 0;
        userAnswers = new Map();
        checked = new Set();

        els.quizArea.style.display = "";
        els.resultsArea.style.display = "none";
        els.restartBtn.style.display = "";
        setStatus("In progress");
        render();
      }

      function finishQuiz() {
        const score = computeScore();
        setStatus("Finished");

        els.quizArea.style.display = "none";
        els.resultsArea.style.display = "";

        els.resultsSummary.textContent = `You got ${score.correct} out of ${quizCards.length} correct.`;

        els.reviewArea.style.display = "none";
        els.reviewToggleBtn.textContent = "Show review";
        els.reviewArea.innerHTML = "";

        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function toggleReview() {
        const showing = els.reviewArea.style.display !== "none";
        if (showing) {
          els.reviewArea.style.display = "none";
          els.reviewToggleBtn.textContent = "Show review";
          return;
        }

        els.reviewArea.innerHTML = "";
        for (let i = 0; i < quizCards.length; i++) {
          const c = quizCards[i];
          const ok = userAnswers.has(c.id) ? isCorrect(c) : false;
          const ua = getUserAnswer(c);

          const div = document.createElement("div");
          div.className = "revItem";

          const head = document.createElement("div");
          head.className = "small";
          head.innerHTML = `#${i + 1} • ${c.type.replaceAll(
            "_",
            " "
          )} • <span class="${ok ? "good" : "bad"}">${
            ok ? "Correct" : "Incorrect"
          }</span>`;

          const q = document.createElement("div");
          q.style.marginTop = "8px";
          q.textContent = c.question;

          const a = document.createElement("div");
          a.className = "small";
          a.style.marginTop = "10px";

          if (c.type === "select_multiple") {
            a.innerHTML = `<div>Your answer: ${
              ua && ua.length ? ua.join(", ") : "(none)"
            }</div>
                     <div>Correct: ${c.correct.join(", ")}</div>`;
          } else {
            a.innerHTML = `<div>Your answer: ${ua || "(none)"}</div>
                     <div>Correct: ${c.correct}</div>`;
          }

          div.appendChild(head);
          div.appendChild(q);
          div.appendChild(a);
          els.reviewArea.appendChild(div);
        }

        els.reviewArea.style.display = "";
        els.reviewToggleBtn.textContent = "Hide review";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function downloadJSON() {
        const payload = quizCards.map((c) => ({
          id: c.id,
          type: c.type,
          question: c.question,
          options: c.options,
          correct: c.correct,
          userAnswer: userAnswers.has(c.id) ? getUserAnswer(c) : null,
          isCorrect: userAnswers.has(c.id) ? isCorrect(c) : null,
        }));

        const blob = new Blob([JSON.stringify(payload, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "quiz_results.json";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      /* Wire up */
      els.startBtn.addEventListener("click", startQuiz);
      els.restartBtn.addEventListener("click", startQuiz);

      els.backBtn.addEventListener("click", () => {
        idx = Math.max(0, idx - 1);
        render();
      });
      els.nextBtn.addEventListener("click", () => {
        idx = Math.min(quizCards.length - 1, idx + 1);
        render();
      });

      els.checkBtn.addEventListener("click", () => {
        const card = quizCards[idx];
        checked.add(card.id);
        showFeedback(card);
        els.scoreText.textContent = `${computeScore().correct} / ${
          quizCards.length
        }`;
      });

      els.finishBtn.addEventListener("click", finishQuiz);
      els.reviewToggleBtn.addEventListener("click", toggleReview);
      els.downloadBtn.addEventListener("click", downloadJSON);

      setStatus("Not started");
    </script>
  </body>
</html>

